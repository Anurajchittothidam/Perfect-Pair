<%-include('../layout/userLayout')%>
	<!-- Start Header Area -->
	<header class="header_area sticky-header">
		<div class="main_menu">
			<nav class="navbar navbar-expand-lg navbar-light main_box">
				<div class="container">
					<!-- Brand and toggle get grouped for better mobile display -->
					<div class="d-flex align-items-center"><a class="navbar-brand logo_h" href="/"><img src="/images/logo shoe.png" alt=""></a><h4>Perfect <br> Pair</h4></div>
					<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
					 aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
					<!-- Collect the nav links, forms, and other content for toggling -->
					<div class="collapse navbar-collapse offset" id="navbarSupportedContent">
						<ul class="nav navbar-nav menu_nav ml-auto">
							<li class="nav-item "><a class="nav-link" href="/">Home</a></li>
							<li class="nav-item submenu dropdown">
								<a href="/shop" class="nav-link dropdown-toggle" 
								 aria-expanded="false">Shop</a>
							</li>
							<% if(logedIn){%>
								<li class="nav-item submenu dropdown">
									<a href="#" class="nav-link dropdown-toggle btn border" style="border-radius:30%; width: 10em;" data-toggle="dropdown" role="button" aria-haspopup="true"
									 aria-expanded="false"><span class="pr-2"></span><%=logedIn.username%></a>
									<ul class="dropdown-menu">
										<li class="nav-item"><a class="nav-link" href="/profile">Profile</a></li>
										<li class="nav-item"><a class="nav-link" href="/logOut">LogOut</a></li>
									</ul>
								</li>
							<%}else{%>
								<li class="nav-item"><a class="nav-link" href="/login">Login</a></li>
							<%}%>
							<li class="nav-item"><a class="nav-link" href="/contact">Contact</a></li>
						</ul>
						<ul class="nav navbar-nav navbar-right">
							<li class="nav-item"><a href="/cart" class="cart"><span class="ti-shopping-cart-full "></span></a></li>
							<li class="nav-item">
								<button class="search"><span class="lnr lnr-magnifier" id="search"></span></button>
							</li>
                            <li class="nav-item"><a href="/wishlist" class="cart"><span class="lnr lnr-heart"></span></a></li>
						</ul>
					</div>
				</div>
			</nav>
		</div>
			<div class="search_input" id="search_input_box">
				<div class="container">
					<a href="/shop?page=<%= page %>&limit=<%= limit %>&category=<%= categoryId %>&sort=<%= sortOption %>" id="search-a" >
						<div class="d-flex">
						<input type="text" class="form-control" id="search_input" name="searchInput" style="width:200px;" placeholder="Search Here">
						<button type="submit" id="search-btn" class="btn lnr lnr-magnifier pt-2"></button>
						<span class="lnr lnr-cross" style="margin-left: 40px;" id="close_search" title="Close Search"></span>
					</div>
				</a>
				</div>
			</div>
		
		
	</header>
	<!-- End Header Area -->


	<!-- Start Banner Area -->
	<section class="banner-area organic-breadcrumb">
		<div class="container">
			<div class="breadcrumb-banner d-flex flex-wrap align-items-center justify-content-end">
				<div class="col-first">
					<h1>Shop Category page</h1>
					<nav class="d-flex align-items-center">
						<a href="index.html">Home<span class="lnr lnr-arrow-right"></span></a>
						<a href="#">Shop<span class="lnr lnr-arrow-right"></span></a>
						<a href="category.html">Fashon Category</a>
					</nav>
				</div>
			</div>
		</div>
	</section>
	<!-- End Banner Area -->
	<div class="container">
		<div class="row">
			<div class="col-xl-3 col-lg-4 col-md-5">
				<div class="sidebar-categories">
					<div class="head">Browse Categories</div>
					<ul class="main-categories">
						  <% category.forEach(category => { %>
							<li class="main-nav-list">
							  <a href="?page=<%= page %>&limit=<%= limit %>&category=<%= category._id %>&sort=<%= sortOption %>&search=<%=Input%>">
								<%= category.category_name %>
							  </a>
							</li>
						  <% }) %>
					</ul>
					  
				</div>
				<div class="sidebar-filter mt-50">
					<div class="top-filter-head">Product Filters</div>
					<div class="common-filter">
					  <% var sortby = "high-to-low" %> 
					  <a class="btn active" data-bs-toggle="" href="?page=<%= page %>&limit=<%= limit %>&category=<%= categoryId %>&sort=<%= sortby %>&search=<%=Input%>">Price High To Low</a>
					</div>
					<div class="common-filter">
					  <% var sortby = "low-to-high" %> 
					  <a class="btn" href="?page=<%= page %>&limit=<%= limit %>&category=<%= categoryId %>&sort=<%= sortby %>&search=<%=Input%>">Price Low To High</a>
					</div>
					<div class="common-filter">
					  <% var sortby = "ascending" %>
					  <a class="btn" href="?page=<%= page %>&limit=<%= limit %>&category=<%= categoryId %>&sort=<%= sortby %>&search=<%=Input%>">Ascending A-Z</a>
					</div>
					<div class="common-filter">
					  <% var sortby = "descending" %> 
					  <a class="btn" href="?page=<%= page %>&limit=<%= limit %>&category=<%= categoryId %>&sort=<%= sortby %>&search=<%=Input%>">Descending Z-A</a>
					</div>
				  </div>
			</div>
			<div class="col-xl-9 col-lg-8 col-md-7">
				<!-- Start Filter Bar -->
				<div class="filter-bar d-flex flex-wrap align-items-center justify-content-between">
					<div class="sorting mr-auto">
					</div>
					<div class="">
						
						<div class="pagination">
							<% if (totalPages > 1) { %>
							  <% if (page > 1) { %>
								<a href="?page=<%= page - 1 %>&limit=<%= limit %>&category=<%= categoryId %>&sort=<%= sortOption %>&search=<%=Input%>">&laquo;</a>
							  <% } %>
							  <% for (let i = 1; i <= totalPages; i++) { %>
								<% if (i === page) { %>
								  <a class="active" href="?page=<%= i %>&limit=<%= limit %>&category=<%= categoryId %>&sort=<%= sortOption %>&search=<%=Input%>"><%= i %></a>
								<% } else { %>
								  <a href="?page=<%= i %>&limit=<%= limit %>&category=<%= categoryId %>&sort=<%= sortOption %>&search=<%=Input%>"><%= i %></a>
								<% } %>
							  <% } %>
							  <% if (page < totalPages) { %>
								<a href="?page=<%= page + 1 %>&limit=<%= limit %>&category=<%= categoryId %>&sort=<%= sortOption %>&search=<%=Input%>">&raquo;</a>
							  <% } %>
							<% } %>
						  </div>
					</div>
				</div>
				<!-- End Filter Bar -->
				<!-- Start Best Seller -->
				<section class="lattest-product-area pb-40 category-list">
					<div class="row" id="products-container">
						<% if(productCount > 0 ){%>
				
							<% product.forEach(products=>{%>
								<!-- single product -->
								<div class="col-lg-4 col-md-6">
									<div class="single-product">
										<a href="/product-detailed/<%=products._id%>">
											<div class="d-flex align-items-center" style="height: 20em;">
												<img class="img-fluid" src="<%=products.image[0].path%>" alt="">
											</div>
										</a>
										<div class="product-details">
											<h6>
												<%=products.name%>
											</h6>
											<div class="price">
												<h6><span>&#8377</span>
													<%=products.price%>
												</h6>
												<!-- <h6 class="l-through"><span>&#8377</span>210.00</h6> -->
											</div>
											<div class="prd-bottom">
				
												<a href="" class="social-info">
													<span class="ti-bag"></span>
													<p class="hover-text">add to bag</p>
												</a>
												<a href="#" onclick="addToWishList('<%=products._id%>')" class="social-info">
													<span class="lnr lnr-heart"></span>
													<p class="hover-text">Wishlist</p>
												</a>
											</div>
										</div>
									</div>
								</div>
								<%})%>
								<%}else{%>
									<div class="col-12" style="height:30rem;">
										<div class=" d-flex flex-column justify-content-center align-items-center" style="margin-top:100px;">
												<h2 class="text-center text-black p-2">Oops!</h2>
												<h2>No products found <br></h2>
												<a class="btn btn-primary mt-3" href="/shop">Back to shop</a>
										</div>
									</div>
								<%}%>
					</div>
				</section>
			<!-- Start Filter Bar -->
		<div class="filter-bar d-flex flex-wrap align-items-center justify-content-end">
			<div class="pagination">
				<% if (totalPages > 1) { %>
				  <% if (page > 1) { %>
					<a href="?page=<%= page - 1 %>&limit=<%= limit %>&category=<%= categoryId %>&sort=<%= sortOption %>&search=<%=Input%>">&laquo;</a>
				  <% } %>
				  <% for (let i = 1; i <= totalPages; i++) { %>
					<% if (i === page) { %>
					  <a class="active" href="?page=<%= i %>&limit=<%= limit %>&category=<%= categoryId %>&sort=<%= sortOption %>&search=<%=Input%>"><%= i %></a>
					<% } else { %>
					  <a href="?page=<%= i %>&limit=<%= limit %>&category=<%= categoryId %>&sort=<%= sortOption %>&search=<%=Input%>"><%= i %></a>
					<% } %>
				  <% } %>
				  <% if (page < totalPages) { %>
					<a href="?page=<%= page + 1 %>&limit=<%= limit %>&category=<%= categoryId %>&sort=<%= sortOption %>&search=<%=Input%>">&raquo;</a>
				  <% } %>
				<% } %>
			  </div>
			
		</div>
		<!-- End Filter Bar -->
		</div>
	</div>

	<!-- Start related-product Area -->
	<section class="related-product-area section_gap_bottom" style="padding-top: 100px;">
		<div class="container">
			<div class="row justify-content-center">
				<div class="col-lg-6 text-center">
					<div class="section-title">
						<h1>Deals of the Week</h1>
						<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore
							magna aliqua.</p>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col-lg-9">
					<div class="row">
						<% pro.slice(0,9).forEach(products=>{%>
						<div class="col-lg-4 col-md-4 col-sm-6 mb-20">
							<div class="single-related-product d-flex">
								<a href="/product-detailed/<%=products._id%>"><img style="object-fit: contain;width: 6em;height:6em;" src="<%=products.image[0].path%>" alt=""></a>
								<div class="desc">
									<a href="#" class="title"><%=products.name%></a>
									<div class="price">
										<h6><span>&#8377</span><%=products.price%></h6>
									</div>
								</div>
							</div>
						</div>
						<%})%> 	
					</div>
				</div>
				<div class="col-lg-3">
					<div class="ctg-right">
						<a href="#" target="_blank">
							<img class="img-fluid d-block mx-auto" src="img/category/c5.jpg" alt="">
						</a>
					</div>
				</div>
			</div>
		</div>
	</section>
	<!-- End related-product Area -->
<script>
	function sort(sortby){
  const productContainer = document.getElementById('products-container');
  const requestOptions = {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      sortby: sortby
    })
  }; 
  fetch('/sortProduct', requestOptions)
    .then((response) => response.json())
    .then((response) => {
      productContainer.innerHTML = "";
      response.Myproduct.forEach((product) => {
        const productElement = document.createElement('div');
        productElement.classList.add('col-lg-4', 'col-md-6');
        productElement.innerHTML = `<div class="single-product">
          <a href="/product-detailed/${product._id}">
            <div class="d-flex align-items-center" style="height: 20em;">
              <img class="img-fluid" src="${product.image[0].path}" alt="">
            </div>
          </a>
          <div class="product-details">
            <h6>${product.name}</h6>
            <div class="price">
              <h6><span>&#8377</span>${product.price}</h6>
              <!-- <h6 class="l-through"><span>&#8377</span>210.00</h6> -->
            </div>
            <div class="prd-bottom">
              <a href="" class="social-info">
                <span class="ti-bag"></span>
                <p class="hover-text">add to Cart</p>
              </a>
              <a href="#" onclick="addToWishList('${product._id}')" class="social-info">
                <span class="lnr lnr-heart"></span>
                <p class="hover-text">Wishlist</p>
              </a>
            </div>
          </div>
        </div>`
        productContainer.appendChild(productElement);
      });
    });
}


</script>

<script>
// Get the input field and the search button
const searchInput = document.getElementById('search_input');
const searchBtn = document.getElementById('search-btn');

// Get the link element and the current href
const link = document.getElementById('search-a');
const href = link.getAttribute('href');

// Attach a click event listener to the search button
searchBtn.addEventListener('click', () => {
  // Get the value of the input field
  const inputValue = searchInput.value.trim();
  
  // Build the new href with the search query parameter
  const newHref = `${href}&search=${inputValue}`;
  
  // Set the new href for the link
  link.setAttribute('href', newHref);
});
</script>


	<script src="/js/ajaxRequest.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
	<%-include('../partials/userFooter')%>

	<%-include('../layout/userLayout2')%>